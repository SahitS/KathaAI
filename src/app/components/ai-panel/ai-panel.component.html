<div class="ai-panel">
  <!-- Header -->
  <div class="ai-header">
    <h3>AI Assistant</h3>
    <button class="close-btn" (click)="closeAiPanel()">
      <svg viewBox="0 0 24 24" fill="none">
        <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
        <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="ai-tabs">
    <button 
      class="ai-tab" 
      [class.active]="activeTab === 'chatbot'"
      (click)="switchTab('chatbot')">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2"/>
      </svg>
      AI Chatbot
    </button>
    <button 
      class="ai-tab" 
      [class.active]="activeTab === 'translate'"
      (click)="switchTab('translate')">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 0 1 6.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" stroke="currentColor" stroke-width="2"/>
      </svg>
      AI Translate
    </button>
    <button 
      class="ai-tab" 
      [class.active]="activeTab === 'summarize'"
      (click)="switchTab('summarize')">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
        <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
        <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
        <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
        <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2"/>
      </svg>
      AI Summarize
    </button>
  </div>

  <!-- Content Area -->
  <div class="ai-content">
    <!-- Chatbot Tab -->
    <div *ngIf="activeTab === 'chatbot'" class="chatbot-section">
      <div class="chat-messages" #chatContainer>
        <div 
          *ngFor="let message of chatMessages" 
          class="message"
          [class.user-message]="message.type === 'user'"
          [class.bot-message]="message.type === 'bot'">
          <div class="message-content">
            <p>{{ message.message }}</p>
            <span class="timestamp">{{ formatTimestamp(message.timestamp) }}</span>
          </div>
        </div>
        
        <!-- Loading indicator -->
        <div *ngIf="isChatLoading" class="message bot-message">
          <div class="message-content">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="chat-input">
        <input 
          type="text" 
          [(ngModel)]="userQuestion"
          placeholder="Ask about Mahabharata..."
          (keyup.enter)="sendMessage()"
          [disabled]="isChatLoading">
        <button 
          (click)="sendMessage()" 
          [disabled]="!userQuestion.trim() || isChatLoading"
          class="send-btn">
          <svg viewBox="0 0 24 24" fill="none">
            <line x1="22" y1="2" x2="11" y2="13" stroke="currentColor" stroke-width="2"/>
            <polygon points="22,2 15,22 11,13 2,9 22,2" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Translation Tab -->
    <div *ngIf="activeTab === 'translate'" class="translate-section">
      <div class="language-selector">
        <label for="language-select">Translate to:</label>
        <select 
          id="language-select"
          [(ngModel)]="selectedLanguage" 
          (change)="onLanguageChange()"
          [disabled]="isTranslating">
          <option *ngFor="let lang of availableLanguages" [value]="lang.code">
            {{ lang.name }}
          </option>
        </select>
      </div>

      <div class="translation-content">
        <!-- Original Text -->
        <div class="text-block original">
          <h4>Original (English)</h4>
          <p>{{ selectedVerse?.Content_eng }}</p>
        </div>

        <!-- Translated Text -->
        <div class="text-block translated">
          <h4>Translation</h4>
          <div *ngIf="isTranslating" class="loading-state">
            <div class="spinner"></div>
            <p>Translating...</p>
          </div>
          <p *ngIf="!isTranslating && translatedText">{{ translatedText }}</p>
          <p *ngIf="!isTranslating && !translatedText" class="placeholder">
            Select a language to see translation
          </p>
        </div>
      </div>
    </div>

    <!-- Summarization Tab -->
    <div *ngIf="activeTab === 'summarize'" class="summarize-section">
      <div class="summarize-content">
        <!-- Original Text -->
        <div class="text-block original">
          <h4>Original Verse</h4>
          <p>{{ selectedVerse?.Content_eng }}</p>
        </div>

        <!-- Summary -->
        <div class="text-block summary">
          <h4>AI Summary</h4>
          <div *ngIf="isSummarizing" class="loading-state">
            <div class="spinner"></div>
            <p>Generating summary...</p>
          </div>
          <p *ngIf="!isSummarizing && summarizedText">{{ summarizedText }}</p>
          <p *ngIf="!isSummarizing && !summarizedText" class="placeholder">
            Click to generate AI summary
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
